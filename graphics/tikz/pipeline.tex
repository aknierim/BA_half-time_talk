\begin{tikzpicture}[scale=0.750, every node/.style={scale=0.8}]
    \node [draw, circle, minimum size=1, align=left] (A) at (0,0) {Simulation Data};

    \uncover<2->{
    \ifdefined\darktheme
        \fill [color=tulightgreen, fill opacity=0.7] (1.5,3) rectangle (7.5, -3);
        \node at (4.5,2) [above] {\includegraphics[width=2cm]{logos/ctapipe_logo_light.pdf}};
        \node at (4.5,2) {\code{white}{v0.15.1}}; %v0.15.1.dev166+gf26107f
    \else
        \fill [color=tugreen, fill opacity=0.3] (1.5,3) rectangle (7.5, -3);
        \node at (4.5,2) [above] {\includegraphics[width=2cm]{logos/ctapipe_logo.png}};
        \node at (4.5,2) [below] {\code{darkgray}{v0.15.1}};
    \fi
    \node [draw, circle, minimum size=1] (B) at (3,0) {\texttt{ctapipe-process}};
    \draw [->, >=latex, to path={-- (\tikztotarget)}] (A) edge (B);
    }

    \uncover<3->{
    \node [above] at (4.5,-2) {Run with python scripts and configs};
    \node [draw, align=left] (BC) at (4.5,-2.5) {\texttt{cleaner\_config.yml}\\\texttt{prod5b\_lapalma\_alpha.yml}};
    }

    \only<3>{
        \ifdefined\darktheme
            \node [draw, color=darkmode, align=left] at (13.5,-0.11) {
                \code{yamlblue}{ImageProcessor}\code{white}{:}\\
                \bigskip
                \quad\code{yamlblue}{image_cleaner_type}\code{white}{:} \code{yamlblue}{MARSImageCleaner}\\
                \quad\quad\code{yamlblue}{MARSImageCleaner}\code{white}{:}\\
                \quad\quad\quad\code{yamlblue}{picture_threshold_pe}\code{white}{:}\\
                \quad\quad\quad\quad\code{white}{-} \code{yamlyellow}{[}\code{white}{type,} \code{yamlorange}{"LST*"}\code{white}{, 8.5}\code{yamlyellow}{]}\\
                \quad\quad\quad\quad\code{white}{-} \code{yamlyellow}{[}\code{white}{type,} \code{yamlorange}{"MST*NectarCam"}\code{white}{, 9.0}\code{yamlyellow}{]}\\
                \quad\quad\quad\code{yamlblue}{boundary_threshold_pe}\code{white}{:}\\
                \quad\quad\quad\quad\code{white}{-} \code{yamlyellow}{[}\code{white}{type,} \code{yamlorange}{"LST*"}\code{white}{, 4.75}\code{yamlyellow}{]}\\
                \quad\quad\quad\quad\code{white}{-} \code{yamlyellow}{[}\code{white}{type,} \code{yamlorange}{"MST*NectarCam"}\code{white}{, 4.5}\code{yamlyellow}{]}\\
                \quad\quad\quad\code{yamlblue}{keep_isolated_pixels}\code{white}{:} \code{yamlblue}{false}\\
                \bigskip
                \quad\quad\quad\code{yamlblue}{min_picture_neighbors}\code{white}{: 2}\\
                \quad\quad\code{yamlblue}{ImageQualityQuery}\code{white}{:}\\
                \quad\quad\quad\code{yamlblue}{quality_criteria}\code{white}{:}\\
                \quad\quad\quad\quad\code{white}{-} \code{yamlyellow}{[}\code{yamlorange}{"enough_pixels"}\code{white}{,} \code{yamlorange}{"np.count_nonzero(image) > 2"}\code{yamlyellow}{]}\\
                \quad\quad\quad\quad\code{white}{-} \code{yamlyellow}{[}\code{yamlorange}{"enough_charge"}\code{white}{,} \code{yamlorange}{"image.sum() > 50"}\code{yamlyellow}{]}
            };
        \else
            \node [draw, color=white, align=left] at (13.5,-0.11) {
                \code{yamlblue}{ImageProcessor}\code{darkgray}{:}\\
                \bigskip
                \quad\code{yamlblue}{image_cleaner_type}\code{darkgray}{:} \code{yamlblue}{MARSImageCleaner}\\
                \quad\quad\code{yamlblue}{MARSImageCleaner}\code{darkgray}{:}\\
                \quad\quad\quad\code{yamlblue}{picture_threshold_pe}\code{darkgray}{:}\\
                \quad\quad\quad\quad\code{darkgray}{-} \code{yamlyellow}{[}\code{darkgray}{type,} \code{yamlorange}{"LST*"}\code{darkgray}{, 8.5}\code{yamlyellow}{]}\\
                \quad\quad\quad\quad\code{darkgray}{-} \code{yamlyellow}{[}\code{darkgray}{type,} \code{yamlorange}{"MST*NectarCam"}\code{darkgray}{, 9.0}\code{yamlyellow}{]}\\
                \quad\quad\quad\code{yamlblue}{boundary_threshold_pe}\code{darkgray}{:}\\
                \quad\quad\quad\quad\code{darkgray}{-} \code{yamlyellow}{[}\code{darkgray}{type,} \code{yamlorange}{"LST*"}\code{darkgray}{, 4.75}\code{yamlyellow}{]}\\
                \quad\quad\quad\quad\code{darkgray}{-} \code{yamlyellow}{[}\code{darkgray}{type,} \code{yamlorange}{"MST*NectarCam"}\code{darkgray}{, 4.5}\code{yamlyellow}{]}\\
                \quad\quad\quad\code{yamlblue}{keep_isolated_pixels}\code{darkgray}{:} \code{yamlblue}{false}\\
                \bigskip
                \quad\quad\quad\code{yamlblue}{min_picture_neighbors}\code{darkgray}{: 2}\\
                \quad\quad\code{yamlblue}{ImageQualityQuery}\code{darkgray}{:}\\
                \quad\quad\quad\code{yamlblue}{quality_criteria}\code{darkgray}{:}\\
                \quad\quad\quad\quad\code{darkgray}{-} \code{yamlyellow}{[}\code{yamlorange}{"enough_pixels"}\code{darkgray}{,} \code{yamlorange}{"np.count_nonzero(image) > 2"}\code{yamlyellow}{]}\\
                \quad\quad\quad\quad\code{darkgray}{-} \code{yamlyellow}{[}\code{yamlorange}{"enough_charge"}\code{darkgray}{,} \code{yamlorange}{"image.sum() > 50"}\code{yamlyellow}{]}
            };
        \fi
        \draw [to path={-| (\tikztotarget)}] (BC) to (7.8,0);
        \draw [->, >=latex, to path={-- (\tikztotarget)}] (7.8,0) to (9,0);
    }

    \uncover<4->{
    \node [draw, circle, minimum size=1] (C) at (6,0) {\texttt{ctapipe-merge}};
    \draw [->, >=latex, to path={-- (\tikztotarget)}] (B) edge (C);
    }

    \uncover<5->{
    \fill [color=tublue, fill opacity=0.3] (7.7,3) rectangle (19, -3);
    \node [draw, circle, minimum size=1, align=center] (D) at (9,0) {Processing\\of\\Telescope-\\Level Data};
    \draw [->, >=latex, to path={-- (\tikztotarget)}] (C) edge (D);
    }

    \uncover<6->{
    \node [draw, circle, minimum size=1] (E1) at (12,2) {DL1 Plots};
    \node [draw, circle, minimum size=1, align=center] (E2) at (12,0) {Angular\\Resolution\\\&\\Separation};
    \node [draw, circle, minimum size=1] (E3) at (12,-2) {Metrics};

    \draw [->, >=latex, to path={|- (\tikztotarget)}] (D) edge (E1);
    \draw [->, >=latex, to path={-- (\tikztotarget)}] (D) edge (E2);
    \draw [->, >=latex, to path={|- (\tikztotarget)}] (D) edge (E3);
    }

    \uncover<7->{
    \node [draw, circle, minimum size=1, align=center] (F) at (15,0) {Effective\\Area};
    \draw [->, >=latex, to path={-- (\tikztotarget)}] (E2) edge (F);
    }

    \uncover<8->{
    \node [draw, circle, minimum size=1, align=center] (G) at (18,0) {Results/\\Plots};
    \draw [->, >=latex, to path={-- (\tikztotarget)}] (F) edge (G);

    \coordinate (FG) at (16.5,0) {};
    \draw [to path={-| (\tikztotarget)}] (E1) to (FG);
    \draw [to path={-| (\tikztotarget)}] (E3) to (FG);
    }
\end{tikzpicture}